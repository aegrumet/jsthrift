<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script src="http://github.com/janl/mustache.js/raw/master/mustache.js"></script> 
<script src="thriftweb.js"></script>
<script src="idljs/ThriftTest.thrift.js"></script>
<script src="parse/all.js"></script>
<script>

$(document).ready(function() {

  $("#idltext").val(thriftTest);
  $("#idlform").on("submit",function(){

    $("#idlcompile").attr("disabled","disabled");
    thriftweb.yy = module.exports;
    thriftweb.parse($("#idltext").val());
    var s = $("#docs");

    var enums_data = [];
    var enums = thriftweb.yy.g_program.get_enums();
    for (var i = 0; i < enums.length; i++) {
      enums_data.push({
        name: enums[i].get_name(),
        doc: enums[i].get_doc(),
      });
    };

    var template = $("#enums-template").html();
    var html = Mustache.to_html(template, {enums: enums_data});
    s.append(html);

    var services = thriftweb.yy.g_program.get_services();
    var services_data = [];
    for (var i = 0; i < services.length; i++) {
      var functions_data = [];
      var fn = services[i].get_functions();
      for (var j = 0; j < fn.length; j++) {
        functions_data.push({
          name: fn[j].get_name(),
          doc: fn[j].get_doc()
        });
      }
      services_data.push({
        name: services[i].get_name(),
        doc: services[i].get_doc(),
        functions: functions_data
      });
    }
    var template = $("#services-template").html();
    var html = Mustache.to_html(template, {services: services_data});
    s.append(html);

    $("#services").on("click","li",function() {
      $(this).find("ul").slideToggle();
    });

    return false;
  });
});
</script>
</head>
<body>

<script id="enums-template" type="text/template">
<div>Enums</div>
<ul id="enums" class="enum-list">{{#enums}}
  <li class="enum"> {{name}} - {{doc}}
{{/enums}}  </ul>
</script>

<script id="services-template" type="text/template">
<div>Services (click to expand)</div>
<ul id="services" class="service-list">{{#services}}
  <li class="service"> {{name}} - {{doc}}
  <ul class="function-list" style="display: none;"> {{#functions}}
    <li> {{name}} - {{doc}} </li>
  {{/functions}} </ul>
  </li>
{{/services}}  </ul>
</script>

<div id="column-right" style="float: right; width:50%;">
  <h1>Parse results</h1>
  <div id="docs"></div>
</div><!-- column-right -->

<div id="column-left" style="width: 50%;">

<h1>IDL</h1>
<form id="idlform">
<input type="submit" id="idlcompile" value="Compile" />
<input type="button" id="refresh" value="Reload" onclick="document.location.reload(true)" />
<br />
<textarea id="idltext" cols="60" rows="25"></textarea>
</form>

</div><!-- column-left -->


</body>
</html>
